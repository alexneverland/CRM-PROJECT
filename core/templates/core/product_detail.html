{# core/templates/core/product_detail.html #}

{% extends 'core/base.html' %}

{% block title %}Î ÏÎ¿ÏŠÏŒÎ½: {{ product.name }}{% endblock %}

{% block content %}

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">ğŸ“¦ ÎšÎ±ÏÏ„Î­Î»Î± Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚: {{ product.name }}</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a href="{% url 'product_edit' product.pk %}" class="btn btn-sm btn-outline-primary me-2">
                <i class="bi bi-pencil-square"></i> Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
            </a>
            <form action="{% url 'product_delete' product.pk %}" method="post" class="delete-form d-inline"
                  data-item-type="Ï„Î¿ Ï€ÏÎ¿ÏŠÏŒÎ½"
                  data-item-name="'{{ product.name|escapejs }}'">
                 {% csrf_token %}
                 <button type="submit" class="btn btn-sm btn-outline-danger">
                    <i class="bi bi-trash"></i> Î”Î¹Î±Î³ÏÎ±Ï†Î®
                 </button>
            </form>
            <a href="/admin/core/product/{{ product.pk }}/change/" target="_blank" class="btn btn-sm btn-outline-secondary ms-2">
                <i class="bi bi-gear"></i> Admin
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Î’Î±ÏƒÎ¹ÎºÎ¬ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î±</div>
                <div class="card-body">
                    <p class="mb-1"><strong>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:</strong> {{ product.code|default:"-" }}</p>
                    <p class="mb-1"><strong>Barcode:</strong> {{ product.barcode|default:"-" }}</p>
                    <p class="mb-1"><strong>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®:</strong> {{ product.description|linebreaksbr|default:"-" }}</p>
                    <p class="mb-1"><strong>ÎœÎ¿Î½. ÎœÎ­Ï„ÏÎ·ÏƒÎ·Ï‚:</strong> {{ product.get_unit_of_measurement_display }}</p>
                     {% if product.batch_number %}
                    <p class="mb-1"><strong>Î‘Ï. Î Î±ÏÏ„Î¯Î´Î±Ï‚:</strong> {{ product.batch_number }}</p>
                    {% endif %}
                    {% if product.expiry_date %}
                    <p class="mb-0"><strong>Î—Î¼ÎµÏ. Î›Î®Î¾Î·Ï‚:</strong> {{ product.expiry_date|date:"d/m/Y" }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬ & Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</div>
                <div class="card-body">
                    <p class="mb-1"><strong>Î¤Î¹Î¼Î® Î ÏÎ»Î·ÏƒÎ·Ï‚:</strong> {{ product.price }} â‚¬</p>
                    <p class="mb-1"><strong>Î¤Î¹Î¼Î® ÎšÏŒÏƒÏ„Î¿Ï…Ï‚:</strong> {{ product.cost_price|default:"-" }} â‚¬</p>
                    <p class="mb-1"><strong>Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±:</strong> <strong class="{% if product.stock_quantity <= product.min_stock_level and product.stock_quantity > 0 %}text-warning{% elif product.stock_quantity <= 0 %}text-danger{% else %}text-success{% endif %}">{{ product.stock_quantity|floatformat:2 }}</strong> {{ product.get_unit_of_measurement_display }}</p>
                    <p class="mb-1"><strong>Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î¿ ÎŒÏÎ¹Î¿:</strong> {{ product.min_stock_level|floatformat:2 }} {{ product.get_unit_of_measurement_display }}</p>
                    <p class="mb-0"><strong>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</strong> {% if product.is_active %}<span class="badge bg-success">Î•Î½ÎµÏÎ³ÏŒ</span>{% else %}<span class="badge bg-danger">Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒ</span>{% endif %}</p>
                </div>
            </div>
        </div>
    </div>
     <div class="row">
        <div class="col-md-12">
            <small class="text-muted">
                Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±: {{ product.created_at|date:"d/m/Y H:i" }} | Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·: {{ product.updated_at|date:"d/m/Y H:i" }}
            </small>
        </div>
    </div>
    <hr>

    {# --- Î™Î£Î¤ÎŸÎ¡Î™ÎšÎŸ Î Î©Î›Î—Î£Î•Î©Î Î Î¡ÎŸÎªÎŸÎÎ¤ÎŸÎ£ --- #}
    <div class="card mt-4">
        <div class="card-header">
            <h3><i class="bi bi-graph-up me-2"></i> Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î Ï‰Î»Î®ÏƒÎµÏ‰Î½ (ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½ÎµÏ‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚)</h3>
        </div>
        <div class="card-body">
            {% if sales_history_items %}
                <div class="table-responsive">
                    <table class="table table-hover table-sm">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Î‘Ï. Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚</th>
                                <th scope="col">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
                                <th scope="col">Î ÎµÎ»Î¬Ï„Î·Ï‚</th>
                                <th scope="col" class="text-center">Î Î¿ÏƒÏŒÏ„Î·Ï„Î±</th>
                                <th scope="col" class="text-end">Î¤Î¹Î¼Î® ÎœÎ¿Î½./Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± (â‚¬)</th>
                                <th scope="col" class="text-end">Î£ÏÎ½Î¿Î»Î¿ Î•Î¯Î´Î¿Ï…Ï‚ (â‚¬)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in sales_history_items %}
                                <tr>
                                    <td><a href="{% url 'order_detail' item.order.pk %}">{{ item.order.order_number }}</a></td>
                                    <td>{{ item.order.order_date|date:"d/m/Y" }}</td>
                                    <td>
                                        {% if item.order.customer %}
                                            <a href="{% url 'customer_detail' item.order.customer.pk %}">{{ item.order.customer }}</a>
                                        {% else %}
                                            [Î”Î¹Î±Î³ÏÎ±Î¼Î¼Î­Î½Î¿Ï‚ Î ÎµÎ»Î¬Ï„Î·Ï‚]
                                        {% endif %}
                                    </td>
                                    <td class="text-center">{{ item.quantity|floatformat:2 }}</td>
                                    <td class="text-end">{{ item.unit_price|floatformat:2 }}</td>
                                    <td class="text-end">{{ item.total_price|floatformat:2 }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info" role="alert">
                    Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½ÎµÏ‚ Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½ÎµÏ‚ Ï€Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÎ¿ÏŠÏŒÎ½.
                </div>
            {% endif %}
        </div>
    </div>
    {# --- Î¤Î•Î›ÎŸÎ£ Î™Î£Î¤ÎŸÎ¡Î™ÎšÎŸÎ¥ Î Î©Î›Î—Î£Î•Î©Î --- #}

    <div class="mt-4">
        <a href="{% url 'product_list' %}" class="btn btn-secondary"><i class="bi bi-arrow-left-circle me-1"></i> Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î· Î›Î¯ÏƒÏ„Î± Î ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½</a>
    </div>

{% endblock content %}